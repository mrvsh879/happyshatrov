<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Office Birds ‚Äî Level 1</title>

  <style>
    html, body { margin:0; padding:0; width:100%; height:100%; overflow:hidden; background:#06121f; font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial; }
    #wrap { position:fixed; inset:0; }
    canvas { display:block; width:100%; height:100%; }

    .hud { position:fixed; left:16px; top:16px; z-index:10; display:flex; gap:12px; align-items:flex-start; pointer-events:none; }
    .panel { background:rgba(9,18,28,.55); border:1px solid rgba(255,255,255,.12); border-radius:10px; padding:10px 12px; color:rgba(255,255,255,.92); backdrop-filter: blur(6px); box-shadow:0 10px 30px rgba(0,0,0,.25); min-width:240px; pointer-events:none; }
    .panel h1{ font-size:14px; margin:0 0 6px 0; font-weight:800; }
    .panel small{ display:block; opacity:.85; font-size:12px; line-height:1.3; }

    .btnbar{ pointer-events:auto; display:flex; gap:10px; align-items:center; }
    button{ pointer-events:auto; background:rgba(255,255,255,.10); color:rgba(255,255,255,.92); border:1px solid rgba(255,255,255,.16); padding:8px 12px; border-radius:10px; cursor:pointer; font-weight:800; }
    button:hover{ background:rgba(255,255,255,.16); }

    .right{ position:fixed; top:16px; right:16px; z-index:10; width:320px; pointer-events:none; }
    .kv{ display:grid; grid-template-columns:1fr auto; gap:6px 10px; margin-top:8px; font-size:12px; opacity:.92; }
    .kv div:nth-child(2n){ font-weight:800; }

    .toast{ position:fixed; left:50%; bottom:14px; transform:translateX(-50%); z-index:10; padding:6px 10px; font-size:12px; color:rgba(255,255,255,.92); background:rgba(0,0,0,.40); border:1px solid rgba(255,255,255,.12); border-radius:999px; backdrop-filter: blur(6px); pointer-events:none; opacity:0; transition:opacity .18s ease; }
    .toast.show{ opacity:1; }
  </style>
</head>

<body>
  <div class="hud">
    <div class="panel">
      <h1><span style="opacity:.9">LEVEL 1</span> &nbsp; Office Birds</h1>
      <small>–ó–∞–∂–º–∏ –Ω–∞ —á–µ–ª–æ–≤–µ—á–∫–µ ‚Üí –ø–æ—Ç—è–Ω–∏ –Ω–∞–∑–∞–¥ ‚Üí –æ—Ç–ø—É—Å—Ç–∏.</small>
      <small>–ß–µ–º —Å–∏–ª—å–Ω–µ–µ –Ω–∞—Ç—è–∂–∫–∞, —Ç–µ–º –¥–∞–ª—å—à–µ –ø–æ–ª—ë—Ç.</small>
      <div class="kv">
        <div>–°—á—ë—Ç:</div><div id="score">0</div>
        <div>–°–ª–æ–º–∞–Ω–æ:</div><div id="broken">0</div>
        <div>–ü–æ–ø–∞–¥–∞–Ω–∏–π:</div><div id="hits">0</div>
      </div>
    </div>

    <div class="btnbar">
      <button id="resetBtn">Reset (–≤—Å—ë –∑–∞–Ω–æ–≤–æ)</button>
      <button id="debugBtn">DEBUG</button>
    </div>
  </div>

  <div class="right">
    <div class="panel">
      <h1>–¶–µ–ª—å</h1>
      <small>–†–∞–∑–≤–∞–ª–∏ –æ—Ñ–∏—Å–Ω—ã–π –¥–æ–º–∏–∫ (2 —ç—Ç–∞–∂–∞).</small>
      <small>–í–Ω—É—Ç—Ä–∏ —Å–∏–¥—è—Ç –º–µ–Ω–µ–¥–∂–µ—Ä—ã –≤ –Ω–∞—É—à–Ω–∏–∫–∞—Ö.</small>
      <small>–ü–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞: 2‚Äì3 —Å–µ–∫ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è ‚Üí –∞–≤—Ç–æ-—Ä–µ—Å–ø–∞–≤–Ω.</small>
      <small>–î–æ–º–∏–∫ –Ω–µ –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è (–ø–æ–ª–æ–º–∫–∏ —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è).</small>
      <div class="kv">
        <div>–°—Ç–∞—Ç—É—Å:</div><div id="status">–ó–∞–≥—Ä—É–∑–∫–∞‚Ä¶</div>
      </div>
    </div>
  </div>

  <div id="wrap"><canvas id="c"></canvas></div>
  <div id="toast" class="toast">‚Ä¶</div>

  <script src="https://cdn.jsdelivr.net/npm/matter-js@0.19.0/build/matter.min.js"></script>

  <script>
  (function(){
    "use strict";

    const $ = (id) => document.getElementById(id);
    const toastEl = $("toast");
    function toast(msg, ms=1400){ toastEl.textContent = msg; toastEl.classList.add("show"); setTimeout(()=>toastEl.classList.remove("show"), ms); }

    function loadImage(src){
      return new Promise((resolve,reject)=>{
        const img = new Image();
        img.onload = ()=>resolve(img);
        img.onerror = ()=>reject(new Error("–ù–µ –∑–∞–≥—Ä—É–∑–∏–ª–∞—Å—å –∫–∞—Ä—Ç–∏–Ω–∫–∞: " + src));
        img.src = src + (src.includes("?") ? "&" : "?") + "v=" + Date.now();
      });
    }

    const ASSETS = {
      bg: "assets/bg_office.png",
      beam: "assets/office/beam.png",
      pillar: "assets/office/pillar.png",
      manager: "assets/office/manager.png",
      humanIdle: "assets/player/human_idle.png",
      humanFly: "assets/player/human_fly.png"
    };

    const {
      Engine, Render, Runner, World, Bodies, Body,
      Constraint, Mouse, MouseConstraint, Events, Composite
    } = Matter;

    let engine, world, render, runner, mouseConstraint, ground;
    let bird = null;
    let birdLaunched = false;
    let birdRespawnTimer = null;

    let DEBUG = false;

    const structure = {
      pillars: [],
      beams: [],
      joints: [],
      managers: [],
      activated: false // –¥–æ–º–∏–∫ "–æ–∂–∏–≤–∞–µ—Ç" —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞
    };

    const stats = { score:0, broken:0, hits:0 };

    const JOINT_BREAK_THRESHOLD = 7.0;
    const MANAGER_HIT_SPEED = 4.3;

    // ====== –í–ê–ñ–ù–û: –±–ª–∏–∂–µ –¥–æ–º–∏–∫ –∫ —á–µ–ª–æ–≤–µ–∫—É ======
    const LAYOUT = {
      floorHeight: 90,
      birdStartX: 170,
      birdStartYOffset: 160,

      // –±—ã–ª–æ 0.62 ‚Äî —Å–ª–∏—à–∫–æ–º –¥–∞–ª–µ–∫–æ. –¥–µ–ª–∞–µ–º –±–ª–∏–∂–µ:
      houseCenterX: () => Math.round(window.innerWidth * 0.55),
      houseBaseY: () => Math.round(window.innerHeight - LAYOUT.floorHeight),
      houseWidth: 340,

      yBottomBeam: () => LAYOUT.houseBaseY() - 40,
      yMidBeam: () => LAYOUT.houseBaseY() - 135,
      yTopBeam: () => LAYOUT.houseBaseY() - 230,

      managersCount: 3
    };

    const SPRITE_TARGET = {
      pillarH: 250,
      beamW: 320,

      // ====== —É–≤–µ–ª–∏—á–∏–ª–∏ "–∫–ª–∏–∫–∞–±–µ–ª—å–Ω–æ—Å—Ç—å" ======
      birdBodyRadius: 46,         // –±—ã–ª–æ 26
      birdWIdle: 120,
      birdWFly: 90,

      managerW: 72
    };

    $("status").textContent = "–ó–∞–≥—Ä—É–∑–∫–∞ –∞—Å—Å–µ—Ç–æ–≤‚Ä¶";

    Promise.all([
      loadImage(ASSETS.bg),
      loadImage(ASSETS.beam),
      loadImage(ASSETS.pillar),
      loadImage(ASSETS.manager),
      loadImage(ASSETS.humanIdle),
      loadImage(ASSETS.humanFly)
    ]).then(([imgBg, imgBeam, imgPillar, imgManager, imgIdle, imgFly])=>{
      start({imgBg, imgBeam, imgPillar, imgManager, imgIdle, imgFly});
    }).catch((e)=>{
      console.error(e);
      $("status").textContent = "–û—à–∏–±–∫–∞ PNG";
      toast("PNG –æ—à–∏–±–∫–∞ ‚Äî –ø—Ä–æ–≤–µ—Ä—å assets/‚Ä¶", 2500);
    });

    function updateHUD(){
      $("score").textContent = String(stats.score);
      $("broken").textContent = String(stats.broken);
      $("hits").textContent = String(stats.hits);
    }

    function start(IMGS){
      $("status").textContent = "–ó–∞–ø—É—Å–∫‚Ä¶";

      const canvas = $("c");
      const wrap = $("wrap");

      engine = Engine.create();
      world = engine.world;
      world.gravity.y = 1.0;

      render = Render.create({
        element: wrap,
        canvas,
        engine,
        options: {
          width: window.innerWidth,
          height: window.innerHeight,
          wireframes: false,
          background: ASSETS.bg,
          pixelRatio: window.devicePixelRatio || 1
        }
      });

      runner = Runner.create();

      // –ß–Å–¢–ö–ò–ô –ü–û–õ
      ground = Bodies.rectangle(
        window.innerWidth/2,
        window.innerHeight - LAYOUT.floorHeight/2,
        window.innerWidth + 600,
        LAYOUT.floorHeight,
        {
          isStatic: true,
          friction: 1.0,
          restitution: 0,
          render: DEBUG ? { fillStyle:"rgba(255,255,255,0.10)" } : { fillStyle:"rgba(0,0,0,0)" }
        }
      );
      World.add(world, ground);

      // –ú—ã—à—å: –≤–∞–∂–µ–Ω pixelRatio –∏–Ω–∞—á–µ –∫–ª–∏–∫–∏ –º–∏–º–æ –Ω–∞ —Ä–µ—Ç–∏–Ω–µ/–º–∞—Å—à—Ç–∞–±–µ
      const mouse = Mouse.create(canvas);
      mouse.pixelRatio = render.options.pixelRatio;

      mouseConstraint = MouseConstraint.create(engine, {
        mouse,
        constraint: { stiffness: 0.22, damping: 0.10, render: { visible:false } }
      });
      World.add(world, mouseConstraint);
      render.mouse = mouse;

      buildStructure(IMGS);
      spawnBird(IMGS);

      bindGameplay(IMGS);

      Render.run(render);
      Runner.run(runner, engine);

      $("resetBtn").addEventListener("click", ()=>resetAll(IMGS));
      $("debugBtn").addEventListener("click", ()=>{
        DEBUG = !DEBUG;
        toast(DEBUG ? "DEBUG: ON" : "DEBUG: OFF", 900);
        resetAll(IMGS);
      });

      window.addEventListener("resize", ()=>onResize(IMGS));

      $("status").textContent = "–ì–æ—Ç–æ–≤–æ";
      updateHUD();
    }

    function onResize(IMGS){
      render.canvas.width = window.innerWidth;
      render.canvas.height = window.innerHeight;
      render.options.width = window.innerWidth;
      render.options.height = window.innerHeight;
      resetAll(IMGS);
    }

    function resetAll(IMGS){
      if (birdRespawnTimer){ clearTimeout(birdRespawnTimer); birdRespawnTimer = null; }

      Composite.clear(world, false);
      World.add(world, ground);
      World.add(world, mouseConstraint);

      stats.score = 0; stats.broken = 0; stats.hits = 0;
      updateHUD();

      structure.pillars = [];
      structure.beams = [];
      structure.joints = [];
      structure.managers = [];
      structure.activated = false;

      bird = null;
      birdLaunched = false;

      buildStructure(IMGS);
      spawnBird(IMGS);

      $("status").textContent = "–ì–æ—Ç–æ–≤–æ";
    }

    // ====== –°–¢–†–û–ò–ú –î–û–ú–ò–ö: –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –°–¢–ê–¢–ò–ß–ù–´–ô, –±–µ–∑ –¥—Ä–æ–∂–∞–Ω–∏—è ======
    function buildStructure(IMGS){
      const baseY = LAYOUT.houseBaseY();
      const cx = LAYOUT.houseCenterX();
      const w = LAYOUT.houseWidth;

      const leftX  = cx - Math.round(w/2);
      const rightX = cx + Math.round(w/2);

      const pillarScale = SPRITE_TARGET.pillarH / IMGS.imgPillar.height;
      const beamScale   = SPRITE_TARGET.beamW   / IMGS.imgBeam.width;

      const pillarH = IMGS.imgPillar.height * pillarScale;
      const pillarW = IMGS.imgPillar.width  * pillarScale;

      const pLeft = Bodies.rectangle(leftX, baseY - pillarH/2, pillarW, pillarH, {
        isStatic: true,
        render: DEBUG
          ? { fillStyle:"rgba(0,210,255,0.20)", strokeStyle:"rgba(110,240,255,0.9)", lineWidth:2 }
          : { sprite:{ texture: ASSETS.pillar, xScale: pillarScale, yScale: pillarScale } }
      });

      const pRight = Bodies.rectangle(rightX, baseY - pillarH/2, pillarW, pillarH, {
        isStatic: true,
        render: DEBUG
          ? { fillStyle:"rgba(0,210,255,0.20)", strokeStyle:"rgba(110,240,255,0.9)", lineWidth:2 }
          : { sprite:{ texture: ASSETS.pillar, xScale: pillarScale, yScale: pillarScale } }
      });

      const beamW = IMGS.imgBeam.width  * beamScale;
      const beamH = IMGS.imgBeam.height * beamScale;

      function beamBody(x,y){
        return Bodies.rectangle(x, y, beamW, beamH, {
          isStatic: true, // –í–ê–ñ–ù–û: –ø–æ–∫–∞ –Ω–µ –≤—ã—Å—Ç—Ä–µ–ª–∏–ª ‚Äî —Å—Ç–∞—Ç–∏—á–Ω–∞
          friction: 0.95,
          restitution: 0.05,
          density: 0.002,
          render: DEBUG
            ? { fillStyle:"rgba(255,120,0,0.25)", strokeStyle:"rgba(255,170,90,0.9)", lineWidth:2 }
            : { sprite:{ texture: ASSETS.beam, xScale: beamScale, yScale: beamScale } }
        });
      }

      const bTop = beamBody(cx, LAYOUT.yTopBeam());
      const bMid = beamBody(cx, LAYOUT.yMidBeam());
      const bBot = beamBody(cx, LAYOUT.yBottomBeam());

      const joints = [];
      function beamToPillar(beam, pillar, sign){
        const joint = Constraint.create({
          bodyA: beam,
          pointA: { x: sign * (beamW/2 - 16), y: 0 },
          bodyB: pillar,
          pointB: { x: 0, y: 0 },
          stiffness: 0.95,
          damping: 0.06,
          length: 0,
          render: { visible:false }
        });
        joint.__breakable = true;
        joint.__broken = false;
        joints.push(joint);
        return joint;
      }

      beamToPillar(bTop, pLeft, -1); beamToPillar(bTop, pRight, +1);
      beamToPillar(bMid, pLeft, -1); beamToPillar(bMid, pRight, +1);
      beamToPillar(bBot, pLeft, -1); beamToPillar(bBot, pRight, +1);

      // Managers (—Ç–æ–∂–µ —Å—Ç–∞—Ç–∏—á–Ω—ã –¥–æ –≤—ã—Å—Ç—Ä–µ–ª–∞)
      const managers = [];
      const mScale = SPRITE_TARGET.managerW / IMGS.imgManager.width;
      const mW = IMGS.imgManager.width * mScale;
      const mH = IMGS.imgManager.height * mScale;

      for (let i=0; i<LAYOUT.managersCount; i++){
        const t = (i+1)/(LAYOUT.managersCount+1);
        const x = cx - w*0.24 + t*(w*0.48);
        const y = LAYOUT.yMidBeam() - beamH/2 - mH/2 + 8;

        const m = Bodies.rectangle(x, y, mW, mH, {
          isStatic: true,
          friction: 0.9,
          restitution: 0.05,
          density: 0.002,
          render: DEBUG
            ? { fillStyle:"rgba(255,255,255,0.16)", strokeStyle:"rgba(255,255,255,0.9)", lineWidth:2 }
            : { sprite:{ texture: ASSETS.manager, xScale: mScale, yScale: mScale } }
        });
        m.__isManager = true;
        m.__alive = true;
        managers.push(m);
      }

      structure.pillars = [pLeft, pRight];
      structure.beams = [bTop, bMid, bBot];
      structure.joints = joints;
      structure.managers = managers;

      World.add(world, [pLeft, pRight, bTop, bMid, bBot, ...joints, ...managers]);
    }

    // ====== –ê–ö–¢–ò–í–ê–¶–ò–Ø –î–û–ú–ò–ö–ê (–ø–æ—Å–ª–µ –≤—ã—Å—Ç—Ä–µ–ª–∞) ======
    function activateStructure(){
      if (structure.activated) return;
      structure.activated = true;

      // –¥–µ–ª–∞–µ–º –±–∞–ª–∫–∏ –∏ –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–º–∏, —á—Ç–æ–±—ã –ª–æ–º–∞–ª–∏—Å—å
      for (const b of structure.beams){
        Body.setStatic(b, false);
        b.frictionAir = 0.01;
      }
      for (const m of structure.managers){
        Body.setStatic(m, false);
        m.frictionAir = 0.02;
      }
      // –∫–æ–ª–æ–Ω—ã –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å —Å—Ç–∞—Ç–∏—á–Ω—ã–º–∏ (–æ–Ω–∏ –∫–∞–∫ "–æ–ø–æ—Ä—ã")
    }

    function spawnBird(IMGS){
      const baseY = window.innerHeight - LAYOUT.floorHeight;
      const start = { x: LAYOUT.birdStartX, y: baseY - LAYOUT.birdStartYOffset };

      const idleScale = SPRITE_TARGET.birdWIdle / IMGS.imgIdle.width;
      const flyScale  = SPRITE_TARGET.birdWFly  / IMGS.imgFly.width;

      bird = Bodies.circle(start.x, start.y, SPRITE_TARGET.birdBodyRadius, {
        restitution: 0.15,
        friction: 0.9,
        frictionAir: 0.012,
        density: 0.004,
        render: DEBUG
          ? { fillStyle:"rgba(255,0,0,0.22)", strokeStyle:"rgba(255,0,0,0.9)", lineWidth:2 }
          : { sprite:{ texture: ASSETS.humanIdle, xScale: idleScale, yScale: idleScale } }
      });

      bird.__start = start;
      bird.__flyTexture = ASSETS.humanFly;
      bird.__idleTexture = ASSETS.humanIdle;
      bird.__flyScale = flyScale;
      bird.__idleScale = idleScale;

      birdLaunched = false;
      World.add(world, bird);
    }

    function setBirdFly(){
      if (!bird || DEBUG) return;
      bird.render.sprite.texture = bird.__flyTexture;
      bird.render.sprite.xScale = bird.__flyScale;
      bird.render.sprite.yScale = bird.__flyScale;
    }
    function setBirdIdle(){
      if (!bird || DEBUG) return;
      bird.render.sprite.texture = bird.__idleTexture;
      bird.render.sprite.xScale = bird.__idleScale;
      bird.render.sprite.yScale = bird.__idleScale;
    }

    function scheduleBirdRespawn(IMGS, delayMs){
      if (birdRespawnTimer) return;
      birdRespawnTimer = setTimeout(()=>{
        birdRespawnTimer = null;
        if (bird){ World.remove(world, bird); bird = null; }
        spawnBird(IMGS);
        setBirdIdle();
        birdLaunched = false;
        $("status").textContent = "–ì–æ—Ç–æ–≤–æ";
      }, delayMs);
    }

    function tryBreakClosestJoint(pair){
      const x = pair.collision.supports && pair.collision.supports[0] ? pair.collision.supports[0].x : (pair.bodyA.position.x + pair.bodyB.position.x)/2;
      const y = pair.collision.supports && pair.collision.supports[0] ? pair.collision.supports[0].y : (pair.bodyA.position.y + pair.bodyB.position.y)/2;

      let best=null, bestD=Infinity;
      for (const j of structure.joints){
        if (!j.__breakable || j.__broken) continue;
        const ax = j.bodyA ? j.bodyA.position.x + (j.pointA ? j.pointA.x : 0) : 0;
        const ay = j.bodyA ? j.bodyA.position.y + (j.pointA ? j.pointA.y : 0) : 0;
        const d = (ax-x)*(ax-x) + (ay-y)*(ay-y);
        if (d<bestD){ bestD=d; best=j; }
      }

      if (best && bestD < 170*170){
        best.__broken = true;
        World.remove(world, best);
        stats.broken += 1;
        stats.score += 10;
        updateHUD();
      }
    }

    function bindGameplay(IMGS){
      // –í–´–°–¢–†–ï–õ: enddrag –ø–æ —Ç–µ–ª—É bird
      Events.on(mouseConstraint, "enddrag", (e)=>{
        if (!bird || e.body !== bird) return;
        if (birdLaunched) return;

        // –∞–∫—Ç–∏–≤–∏—Ä—É–µ–º –¥–æ–º–∏–∫ —Ç–æ–ª—å–∫–æ —Ç–µ–ø–µ—Ä—å ‚Äî –¥—Ä–æ–∂–∞–Ω–∏—è –Ω–∞ —Å—Ç–∞—Ä—Ç–µ –Ω–µ—Ç
        activateStructure();

        const start = bird.__start;
        const pos = bird.position;

        const dx = start.x - pos.x;
        const dy = start.y - pos.y;

        const pullMax = 150;
        const dist = Math.hypot(dx, dy) || 1;
        const pull = Math.min(pullMax, dist);
        const k = pull / dist;

        const ndx = dx * k;
        const ndy = dy * k;

        // –°–ò–õ–ê: —Ä–∞–Ω—å—à–µ –±—ã–ª–æ —Å–ª–∞–±–æ–≤–∞—Ç–æ/–¥–∞–ª–µ–∫–æ. –¢–µ–ø–µ—Ä—å —Ç–æ—á–Ω–µ–µ:
        const power = 0.20;

        Body.setPosition(bird, start);
        Body.setVelocity(bird, { x: ndx*power, y: ndy*power });
        Body.setAngularVelocity(bird, 0.15);

        birdLaunched = true;
        setBirdFly();

        $("status").textContent = "–ü–æ–ª–µ—Ç–µ–ª!";
        stats.score += 1;
        updateHUD();

        // 2.5 —Å–µ–∫ —Ä–∞–∑—Ä—É—à–µ–Ω–∏—è ‚Üí —Ä–µ—Å–ø–∞–≤–Ω –ø—Ç–∏—Ü—ã, –¥–æ–º–∏–∫ –æ—Å—Ç–∞—ë—Ç—Å—è —Å–ª–æ–º–∞–Ω–Ω—ã–º
        scheduleBirdRespawn(IMGS, 2500);
      });

      Events.on(engine, "collisionStart", (event)=>{
        if (!structure.activated) return;

        for (const pair of event.pairs){
          const a = pair.bodyA, b = pair.bodyB;

          // –ø–æ–ø–∞–¥–∞–Ω–∏–µ –ø–æ –º–µ–Ω–µ–¥–∂–µ—Ä—É
          if ((a.__isManager && b===bird) || (b.__isManager && a===bird)){
            const m = a.__isManager ? a : b;
            const v = bird ? Math.hypot(bird.velocity.x, bird.velocity.y) : 0;
            if (m.__alive && v > MANAGER_HIT_SPEED){
              m.__alive = false;
              stats.hits += 1;
              stats.score += 25;
              updateHUD();
              toast("–ú–µ–Ω–µ–¥–∂–µ—Ä –ø–æ–µ—Ö–∞–ª üòµ", 800);
            }
          }

          const va = Math.hypot(a.velocity.x, a.velocity.y);
          const vb = Math.hypot(b.velocity.x, b.velocity.y);
          const impact = Math.abs(va - vb);

          if (impact > JOINT_BREAK_THRESHOLD){
            tryBreakClosestJoint(pair);
          }
        }
      });

      Events.on(engine, "beforeUpdate", ()=>{
        if (bird && birdLaunched){
          const out =
            bird.position.x < -250 ||
            bird.position.x > window.innerWidth + 250 ||
            bird.position.y > window.innerHeight + 450 ||
            bird.position.y < -450;

          if (out) scheduleBirdRespawn(IMGS, 200);

          const speed = Math.hypot(bird.velocity.x, bird.velocity.y);
          if (speed < 0.35 && bird.position.y > window.innerHeight - LAYOUT.floorHeight - 220){
            setBirdIdle();
          }
        }
      });
    }

  })();
  </script>
</body>
</html>
